<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotes - 情绪支持应用</title>
    <link rel="stylesheet" href="css/emotion_quotes.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="js/storage.js"></script>
</head>
<body>
    <div class="header">
        <div style="display: flex; align-items: center;">
            <a id="back-link" href="emotion.html?type=happy" class="back-button">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div id="page-title" class="page-title">Quotes</div>
        </div>
        <div class="more-options">
            <i class="fas fa-ellipsis-v"></i>
        </div>
    </div>
    
    <div id="quotes-container" class="quotes-container">
        
    </div>

    <script>
        
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                type: params.get('type') || 'happy'
            };
        }
        
        
        function setThemeColors(primaryColor, secondaryColor) {
            document.documentElement.style.setProperty('--primary-color', primaryColor);
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
        }
        
        
        function loadQuotes(quotes) {
            const quotesContainer = document.getElementById('quotes-container');
            quotesContainer.innerHTML = '';
            
            quotes.forEach(quote => {
                const quoteCard = document.createElement('div');
                quoteCard.className = 'quote-card';
                
                
                const isSaved = isItemSaved('savedQuotes', quote);
                const heartClass = isSaved ? 'fas' : 'far';
                const buttonClass = isSaved ? 'save-button saved' : 'save-button';
                
                quoteCard.innerHTML = `
                    <div class="quote-content">
                        <div class="quote-text">${quote.text}</div>
                        <div class="quote-author">${quote.author}</div>
                    </div>
                    <button class="${buttonClass}">
                        <i class="${heartClass} fa-heart"></i> Save
                    </button>
                `;
                
                quotesContainer.appendChild(quoteCard);
            });
            
            
            document.querySelectorAll('.save-button').forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    const icon = this.querySelector('i');
                    const quoteItem = this.closest('.quote-card');
                    const quoteText = quoteItem.querySelector('.quote-text').textContent;
                    const quoteAuthor = quoteItem.querySelector('.quote-author').textContent;
                    
                    const quoteData = {
                        text: quoteText,
                        author: quoteAuthor
                    };
                    
                    if (icon.classList.contains('far')) {
                       
                        if (saveItem('savedQuotes', quoteData)) {
                            
                            icon.classList.remove('far');
                            icon.classList.add('fas');
                            this.classList.add('saved');
                            this.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-color');
                            
                            
                            showToast('Quote saved successfully!');
                        }
                    } else {
                        
                        const savedQuotes = window.getSavedItems('savedQuotes');
                        const quoteIndex = savedQuotes.findIndex(q => q.text === quoteData.text);
                        
                        if (quoteIndex !== -1 && removeItem('savedQuotes', quoteIndex)) {
                            
                            icon.classList.remove('fas');
                            icon.classList.add('far');
                            this.classList.remove('saved');
                            this.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--secondary-color');
                            
                            
                            showToast('Quote removed from saved items');
                        }
                    }
                });
            });
        }
        
        
        function showToast(message) {
            
            let toast = document.querySelector('.toast');
            
            if (!toast) {
                toast = document.createElement('div');
                toast.className = 'toast';
                document.body.appendChild(toast);
            }
            
            
            toast.textContent = message;
            toast.classList.add('show');
            
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }
        
        
        function initPage() {
            const params = getUrlParams();
            const emotionType = params.type;
            
            fetch('./emotions.json')
                .then(response => response.json())
                .then(data => {
                    const emotionData = data[emotionType];
                    if (!emotionData) {
                        console.error('Emotion type not found in configuration');
                        return;
                    }
                    
                    
                    document.title = emotionData.sections.quotes.title + ' - 情绪支持应用';
                    document.getElementById('page-title').textContent = emotionData.sections.quotes.title;
                    
                    
                    setThemeColors(emotionData.primaryColor, emotionData.secondaryColor);
                    
                    
                    document.getElementById('back-link').href = `emotion.html?type=${emotionType}`;
                    
                    
                    loadQuotes(emotionData.sections.quotes.allQuotes);
                    
                })
                .catch(error => {
                    console.error('Error loading emotion data:', error);
                });
        }
        
        
        window.onload = initPage;
        
    </script>
</body>
</html> 