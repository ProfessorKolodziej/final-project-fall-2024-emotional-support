<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>情绪支持应用</title>
    <link rel="stylesheet" href="css/emotion.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div class="header">
        <div style="display: flex; align-items: center;">
            <a href="index.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div id="page-title" class="page-title">情绪</div>
        </div>
        <div class="more-options">
            <i class="fas fa-ellipsis-v"></i>
        </div>
    </div>
    
    <!-- 音乐部分 -->
    <div class="section" id="music-section">
        <div class="section-header">
            <div id="music-title" class="section-title">音乐</div>
            <button id="music-more" class="more-button">More</button>
        </div>
        
        <div id="music-container"></div>
    </div>
    
    <!-- 图片部分 -->
    <div class="section" id="images-section">
        <div class="section-header">
            <div id="images-title" class="section-title">图片</div>
            <button id="images-more" class="more-button">More</button>
        </div>
        
        <div id="images-container" class="images-container"></div>
    </div>
    
    <!-- 名言部分 -->
    <div class="section" id="quotes-section">
        <div class="section-header">
            <div id="quotes-title" class="section-title">名言</div>
            <button id="quotes-more" class="more-button">More</button>
        </div>
        
        <div id="quotes-container"></div>
    </div>

    <script>
        // 从URL获取情绪类型
        function getEmotionType() {
            const urlParams = new URLSearchParams(window.location.search);
            const emotionType = urlParams.get('type');
            return emotionType || 'happy'; // 默认为happy
        }

        // 设置CSS变量
        function setThemeColors(primaryColor, secondaryColor) {
            document.documentElement.style.setProperty('--primary-color', primaryColor);
            document.documentElement.style.setProperty('--secondary-color', secondaryColor);
        }

        // 渲染音乐部分
        function renderMusicSection(musicData) {
            const container = document.getElementById('music-container');
            container.innerHTML = '';
            
            document.getElementById('music-title').textContent = musicData.title;
            document.getElementById('music-more').onclick = () => window.location.href = musicData.moreLink;
            
            musicData.items.forEach((music, index) => {
                const musicItem = document.createElement('div');
                musicItem.className = 'music-item';
                musicItem.onclick = () => window.location.href = `music_player.html?type=${getEmotionType()}&index=${index}`;
                
                musicItem.innerHTML = `
                    <div class="music-icon">
                        <i class="fas ${music.icon}"></i>
                    </div>
                    <div class="music-details">
                        <div class="music-title">${music.title}</div>
                        <div class="music-artist">${music.artist}</div>
                    </div>
                    <div class="play-button">
                        <i class="fas fa-play"></i>
                    </div>
                `;
                
                container.appendChild(musicItem);
            });
        }

        // 渲染图片部分
        function renderImagesSection(imagesData) {
            const container = document.getElementById('images-container');
            container.innerHTML = '';
            
            document.getElementById('images-title').textContent = imagesData.title;
            document.getElementById('images-more').onclick = () => window.location.href = `emotion_images.html?type=${getEmotionType()}`;
            
            imagesData.items.forEach(imageUrl => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                
                imageItem.innerHTML = `<img src="${imageUrl}" alt="Emotion image">`;
                
                container.appendChild(imageItem);
            });
        }

        // 渲染名言部分
        function renderQuotesSection(quotesData) {
            const container = document.getElementById('quotes-container');
            container.innerHTML = '';
            
            document.getElementById('quotes-title').textContent = quotesData.title;
            document.getElementById('quotes-more').onclick = () => window.location.href = `emotion_quotes.html?type=${getEmotionType()}`;
            
            quotesData.items.forEach(quote => {
                const quoteItem = document.createElement('div');
                quoteItem.className = 'affirmation';
                
                quoteItem.innerHTML = `
                    <div class="quote">${quote.text}</div>
                    <div class="author">${quote.author}</div>
                    <button class="save-button">
                        <i class="fas fa-heart"></i> Save
                    </button>
                `;
                
                container.appendChild(quoteItem);
            });
        }

        // 处理重定向
        function handleRedirect(desktopRedirect) {
            // 添加自动重定向代码，根据屏幕宽度判断是否应该跳转到PC版
            if (window.innerWidth >= 1024) {
                window.location.href = desktopRedirect;
            }
            
            // 当窗口大小改变时也进行检查
            window.onresize = function() {
                if (window.innerWidth >= 1024) {
                    window.location.href = desktopRedirect;
                }
            };
        }

        // 初始化页面
        function initPage() {
            const emotionType = getEmotionType();
            
            fetch('./emotions.json')
                .then(response => response.json())
                .then(data => {
                    const emotionData = data[emotionType];
                    if (!emotionData) {
                        console.error('Emotion type not found in configuration');
                        return;
                    }
                    
                    // 设置页面标题
                    document.title = emotionData.title + ' - 情绪支持应用';
                    document.getElementById('page-title').textContent = emotionData.title;
                    
                    // 设置主题颜色
                    setThemeColors(emotionData.primaryColor, emotionData.secondaryColor);
                    
                    // 渲染各部分内容
                    renderMusicSection(emotionData.sections.music);
                    renderImagesSection(emotionData.sections.images);
                    renderQuotesSection(emotionData.sections.quotes);
                    
                    // 处理PC版重定向
                    handleRedirect(emotionData.desktopRedirect);
                })
                .catch(error => {
                    console.error('Error loading emotion data:', error);
                });
        }
        
        // 初始化页面
        window.onload = initPage;
        
        // 为保存按钮添加点击事件（动态绑定）
        document.addEventListener('click', function(event) {
            if (event.target.closest('.save-button')) {
                const saveButton = event.target.closest('.save-button');
                const icon = saveButton.querySelector('i');
                
                if (icon.classList.contains('far')) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    saveButton.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-color');
                } else {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    saveButton.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--secondary-color');
                }
            }
        });
    </script>
</body>
</html> 